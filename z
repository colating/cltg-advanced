#!/bin/bash
 
# 1. 获取所有暂存文件的修改时间，并找出最大值
latest_mtime=$(
    git diff --cached --name-only | \
    xargs stat -c %Y 2>/dev/null | \
    awk 'BEGIN { max=0 } { if ($1 > max) max=$1 } END { print max }'
)
 
# 2. 计算时间偏移
author_timestamp=$((latest_mtime + 300))
committer_timestamp=$((author_timestamp + 480))
 
# 3. 提交
export GIT_AUTHOR_DATE=$(date -d "@$author_timestamp" +"%Y-%m-%d %H:%M:%S")
export GIT_COMMITTER_DATE=$(date -d "@$committer_timestamp" +"%Y-%m-%d %H:%M:%S")
git commit -m "提交信息"
 
# 4. 输出
echo "最新修改时间: $(date -d "@$latest_mtime" +"%Y-%m-%d %H:%M:%S")"
echo "作者时间（加5分钟）: $GIT_AUTHOR_DATE"
echo "提交时间（再加8分钟）: $GIT_COMMITTER_DATE"
